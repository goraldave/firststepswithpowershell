$logPath = 'C:\Logs'
$logFile = "$logPath\driveCheck.log" 

try {
    if (-not (Test-Path -Path $logPath -ErrorAction Stop )) {
        New-Item -ItemType Directory -Path $logPath -ErrorAction Stop | Out-Null
        New-Item -ItemType File -Path $logFile -ErrorAction Stop | Out-Null
    }
}
catch {
    throw
}

Add-Content -Path $logFile -Value "[INFO] Running $PSCommandPath"


try {
        $volume = Get-Volume -ErrorAction Stop | Where-Object { $_.DriveLetter -eq $Drive }
       
        if ($volume) {
            $total = $volume.Size
            $percentFree = [int](($volume.SizeRemaining / $total) * 100)
            Add-Content -Path $logFile -Value "[INFO] Percent Free: $percentFree%"
        }
        else {
            Add-Content -Path $logFile -Value "[ERROR] $Drive was not found."
            throw
        }
    }
catch {
    Add-Content -Path $logFile -Value '[ERROR] Unable to retrieve volume information:'
    Add-Content -Path $logFile -Value $_
    throw
}



if ($percentFree -le 15) 
{
    Write-HOST "You have only $percentFree% disk space." -BackgroundColor Black -ForegroundColor RED
    Add-Content -Path $logFile -Value '[INFO] Message about low disk space sent.'
    }
else
    {
    Write-HOST "You have $percentFree%." -BackgroundColor Black -ForegroundColor Green
     Add-Content -Path $logFile -Value '[INFO] Message about disk space sent.'
    }
